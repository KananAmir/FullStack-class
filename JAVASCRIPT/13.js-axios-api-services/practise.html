<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Random Joke (Sv443 JokeAPI)</title>
  <!-- Tailwind (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>
<body class="min-h-screen bg-gray-50 text-gray-900 antialiased">
  <main class="mx-auto max-w-2xl px-4 py-10">
    <!-- Header -->
    <header class="mb-6 flex items-center justify-between">
      <h1 class="text-2xl font-bold tracking-tight">Random Joke</h1>
      <a href="https://sv443.net/jokeapi/v2/joke/Any" target="_blank" class="text-sm text-indigo-600 hover:underline">API Linki</a>
    </header>

    <!-- Controls -->
    <section class="mb-4 grid grid-cols-1 gap-3 sm:grid-cols-3">
      <label class="flex flex-col rounded-xl bg-white p-3 shadow-sm ring-1 ring-gray-200/70">
        <span class="text-xs font-medium text-gray-600 mb-1">Kateqoriya</span>
        <select id="category" class="rounded-lg border-gray-300 text-sm">
          <option value="Any">Any</option>
          <option value="Programming">Programming</option>
          <option value="Misc">Misc</option>
          <option value="Dark">Dark</option>
          <option value="Pun">Pun</option>
          <option value="Spooky">Spooky</option>
          <option value="Christmas">Christmas</option>
        </select>
      </label>

      <label class="flex items-center justify-between rounded-xl bg-white p-3 shadow-sm ring-1 ring-gray-200/70">
        <div class="flex flex-col">
          <span class="text-xs font-medium text-gray-600">Safe Mode</span>
          <span class="text-[11px] text-gray-500">NSFW tipli zarafatları filtrə edir</span>
        </div>
        <input id="safeMode" type="checkbox" class="h-5 w-5 accent-indigo-600" />
      </label>

      <div class="rounded-xl bg-white p-3 shadow-sm ring-1 ring-gray-200/70">
        <div class="text-xs font-medium text-gray-600 mb-1">Blacklist (filtr)</div>
        <div class="flex flex-wrap gap-3 text-sm">
          <label class="inline-flex items-center gap-2">
            <input type="checkbox" class="accent-indigo-600 blacklist" value="nsfw" />
            nsfw
          </label>
          <label class="inline-flex items-center gap-2">
            <input type="checkbox" class="accent-indigo-600 blacklist" value="racist" />
            racist
          </label>
          <label class="inline-flex items-center gap-2">
            <input type="checkbox" class="accent-indigo-600 blacklist" value="sexist" />
            sexist
          </label>
          <label class="inline-flex items-center gap-2">
            <input type="checkbox" class="accent-indigo-600 blacklist" value="explicit" />
            explicit
          </label>
          <label class="inline-flex items-center gap-2">
            <input type="checkbox" class="accent-indigo-600 blacklist" value="religious" />
            religious
          </label>
          <label class="inline-flex items-center gap-2">
            <input type="checkbox" class="accent-indigo-600 blacklist" value="political" />
            political
          </label>
        </div>
      </div>
    </section>

    <!-- Action buttons -->
    <div class="mb-4 flex flex-wrap items-center gap-3">
      <button id="btnFetch" class="inline-flex items-center gap-2 rounded-xl bg-indigo-600 px-4 py-2 text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
        Yeni zarafat
      </button>

      <button id="btnAuto" class="inline-flex items-center gap-2 rounded-xl bg-white px-4 py-2 text-gray-800 ring-1 ring-gray-300 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500">
        Auto: OFF
      </button>

      <div class="text-xs text-gray-500">Auto interval: <span id="intervalInfo">5s</span></div>
    </div>

    <!-- Joke card -->
    <section class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-gray-200/70">
      <div id="loader" class="hidden mb-3">
        <div class="h-2 w-full overflow-hidden rounded-full bg-gray-200">
          <div class="h-2 w-1/3 animate-pulse rounded-full bg-indigo-500"></div>
        </div>
      </div>

      <div id="errorBox" class="mb-3 hidden rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700"></div>

      <!-- Single joke -->
      <p id="singleJoke" class="hidden text-lg leading-7"></p>

      <!-- Two-part joke -->
      <div id="twoPartWrap" class="hidden space-y-3">
        <p id="setup" class="text-lg leading-7"></p>
        <button id="reveal" class="rounded-lg bg-gray-900 px-3 py-1.5 text-sm text-white hover:bg-black">
          Cavabı göstər
        </button>
        <p id="delivery" class="hidden rounded-lg bg-gray-50 p-3 leading-7 ring-1 ring-gray-200/70"></p>
      </div>

      <div class="mt-4 flex items-center gap-2">
        <button id="copyBtn" class="text-sm text-indigo-600 hover:underline">Kopyala</button>
        <span id="copiedMsg" class="hidden text-sm text-emerald-600">Kopyalandı ✓</span>
      </div>
    </section>

    <!-- Footer -->
    <footer class="mt-8 text-center text-xs text-gray-500">
      Mənbə: Sv443 JokeAPI
    </footer>
  </main>

  <script>
    const btnFetch = document.getElementById('btnFetch');
    const btnAuto = document.getElementById('btnAuto');
    const intervalInfo = document.getElementById('intervalInfo');
    const loader = document.getElementById('loader');
    const errorBox = document.getElementById('errorBox');

    const singleJoke = document.getElementById('singleJoke');
    const twoPartWrap = document.getElementById('twoPartWrap');
    const setupEl = document.getElementById('setup');
    const deliveryEl = document.getElementById('delivery');
    const revealBtn = document.getElementById('reveal');

    const copyBtn = document.getElementById('copyBtn');
    const copiedMsg = document.getElementById('copiedMsg');

    const categorySel = document.getElementById('category');
    const safeMode = document.getElementById('safeMode');

    const AUTO_MS = 5000; // 5 saniyə
    intervalInfo.textContent = (AUTO_MS/1000) + 's';
    let autoId = null;

    function buildUrl() {
      const base = 'https://sv443.net/jokeapi/v2/joke/';
      const category = categorySel.value || 'Any';

      const params = new URLSearchParams();

      // safe-mode
      if (safeMode.checked) params.set('safe-mode', '');

      // blacklist
      const flags = Array.from(document.querySelectorAll('.blacklist:checked')).map(i => i.value);
      if (flags.length) params.set('blacklistFlags', flags.join(','));

      const qs = params.toString();
      return qs ? `${base}${category}?${qs}` : `${base}${category}`;
    }

    async function fetchJoke() {
      showLoader(true);
      showError('');
      hideAll();

      try {
        const url = buildUrl();
        const res = await fetch(url);
        if (!res.ok) throw new Error('Şəbəkə xətası: ' + res.status);
        const data = await res.json();

        if (data.error) {
          throw new Error(data.message || 'Naməlum API xətası');
        }

        renderJoke(data);
      } catch (err) {
        showError(err.message || 'Xəta baş verdi');
      } finally {
        showLoader(false);
      }
    }

    function renderJoke(data) {
      if (data.type === 'single') {
        singleJoke.textContent = data.joke || '(boş)';
        singleJoke.classList.remove('hidden');
        twoPartWrap.classList.add('hidden');
      } else {
        setupEl.textContent = data.setup || '(setup yoxdur)';
        deliveryEl.textContent = data.delivery || '(delivery yoxdur)';
        deliveryEl.classList.add('hidden');
        twoPartWrap.classList.remove('hidden');
        singleJoke.classList.add('hidden');
      }
    }

    function hideAll() {
      singleJoke.classList.add('hidden');
      twoPartWrap.classList.add('hidden');
      deliveryEl.classList.add('hidden');
    }

    function showLoader(flag) {
      loader.classList.toggle('hidden', !flag);
    }

    function showError(msg) {
      if (msg) {
        errorBox.textContent = msg;
        errorBox.classList.remove('hidden');
      } else {
        errorBox.textContent = '';
        errorBox.classList.add('hidden');
      }
    }

    // Events
    btnFetch.addEventListener('click', fetchJoke);

    btnAuto.addEventListener('click', () => {
      if (autoId) {
        clearInterval(autoId);
        autoId = null;
        btnAuto.textContent = 'Auto: OFF';
        btnAuto.classList.remove('bg-indigo-600','text-white');
        btnAuto.classList.add('bg-white','text-gray-800','ring-1','ring-gray-300');
      } else {
        fetchJoke();
        autoId = setInterval(fetchJoke, AUTO_MS);
        btnAuto.textContent = 'Auto: ON';
        btnAuto.classList.add('bg-indigo-600','text-white');
        btnAuto.classList.remove('bg-white','text-gray-800','ring-1','ring-gray-300');
      }
    });

    revealBtn.addEventListener('click', () => {
      deliveryEl.classList.toggle('hidden');
    });

    copyBtn.addEventListener('click', async () => {
      const text = !singleJoke.classList.contains('hidden')
        ? singleJoke.textContent
        : `${setupEl.textContent}\n${deliveryEl.textContent}`;

      try {
        await navigator.clipboard.writeText(text || '');
        copiedMsg.classList.remove('hidden');
        setTimeout(() => copiedMsg.classList.add('hidden'), 1500);
      } catch {
        alert('Kopyalama dəstəklənmir.');
      }
    });

    // İlk yükləmədə 1 dəfə çəksin
    fetchJoke();
  </script>
</body>
</html>
